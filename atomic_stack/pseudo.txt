abstract lock-free stack pattern
push(node):
	node.next = head
	while !atomic_update(head, node.next, node):
		node.next = head

pop():
	while true:
		old_head = head
		if old_head == null: return null
		new_head = old_head.next
		if atomic_update(head, old_head, new_head):
			return old_head